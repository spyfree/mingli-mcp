# é¡¹ç›®æ€»ç»“ - ç´«å¾®å‘½ç†MCPæœåŠ¡

## âœ… é¡¹ç›®çŠ¶æ€

**é¡¹ç›®å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡ï¼** ğŸ‰

## ğŸ“¦ å·²äº¤ä»˜å†…å®¹

### 1. æ ¸å¿ƒæ¶æ„ âœ…

#### ä¸‰å±‚æŠ½è±¡è®¾è®¡
- **æ ¸å¿ƒå±‚ (core/)**: å‘½ç†ç³»ç»ŸæŠ½è±¡åŸºç±»ã€æ•°æ®æ¨¡å‹
- **ä¼ è¾“å±‚ (transports/)**: æ”¯æŒå¤šç§ä¼ è¾“åè®®ï¼ˆstdio/HTTP/WebSocketï¼‰
- **ç³»ç»Ÿå±‚ (systems/)**: æ’ä»¶åŒ–å‘½ç†ç³»ç»Ÿå®ç°

#### è®¾è®¡ç‰¹ç‚¹
- âœ… **é«˜åº¦å¯æ‰©å±•**: æ·»åŠ æ–°ç³»ç»Ÿåªéœ€3æ­¥
- âœ… **ä¼ è¾“å±‚è§£è€¦**: æ”¯æŒstdio/HTTP/WebSocketç­‰å¤šç§ä¼ è¾“
- âœ… **æ’ä»¶åŒ–æ³¨å†Œ**: è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæ–°ç³»ç»Ÿ
- âœ… **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰ç³»ç»Ÿéµå¾ªBaseFortuneSystemè§„èŒƒ

### 2. ç´«å¾®æ–—æ•°ç³»ç»Ÿ âœ…

#### å·²å®ç°åŠŸèƒ½
- âœ… **å®Œæ•´æ’ç›˜**: åäºŒå®«ã€ä¸»æ˜Ÿã€è¾…æ˜Ÿã€æ‚è€€ã€å››åŒ–
- âœ… **è¿åŠ¿æŸ¥è¯¢**: å¤§é™ã€æµå¹´ã€æµæœˆã€æµæ—¥ã€æµæ—¶
- âœ… **å®«ä½åˆ†æ**: æ·±åº¦åˆ†æç‰¹å®šå®«ä½
- âœ… **å¤šç§å†æ³•**: æ”¯æŒé˜³å†å’Œå†œå†
- âœ… **æ ¼å¼åŒ–è¾“å‡º**: JSONå’ŒMarkdownä¸¤ç§æ ¼å¼

#### æµ‹è¯•ç»“æœ
```
âœ… æ’ç›˜æµ‹è¯•é€šè¿‡
âœ… è¿åŠ¿æµ‹è¯•é€šè¿‡
âœ… å®«ä½åˆ†ææµ‹è¯•é€šè¿‡
âœ… å†œå†æµ‹è¯•é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### 3. MCPé›†æˆ âœ…

#### å·²å®ç°å·¥å…·
1. **get_ziwei_chart** - ç´«å¾®æ’ç›˜
2. **get_ziwei_fortune** - è¿åŠ¿æŸ¥è¯¢
3. **analyze_ziwei_palace** - å®«ä½åˆ†æ
4. **list_fortune_systems** - ç³»ç»Ÿåˆ—è¡¨

#### MCPç‰¹æ€§
- âœ… å®Œå…¨å…¼å®¹MCPåè®® 2024-11-05
- âœ… stdioä¼ è¾“ï¼ˆé€‚ç”¨äºCursorï¼‰
- âœ… JSON-RPC 2.0æ ‡å‡†
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å‚æ•°éªŒè¯å’Œç±»å‹æ£€æŸ¥

### 4. æ–‡æ¡£ âœ…

- âœ… **README.md** - é¡¹ç›®ä»‹ç»å’Œä½¿ç”¨æŒ‡å—
- âœ… **QUICKSTART.md** - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- âœ… **ARCHITECTURE.md** - è¯¦ç»†æ¶æ„è®¾è®¡æ–‡æ¡£
- âœ… **ä»£ç æ³¨é‡Š** - å®Œæ•´çš„å‡½æ•°å’Œç±»æ–‡æ¡£

## ğŸ“ é¡¹ç›®ç»“æ„

```
ziwei_mcp/
â”œâ”€â”€ mingli_mcp.py              # MCPæœåŠ¡ä¸»å…¥å£ âœ…
â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç† âœ…
â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨ âœ…
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹ âœ…
â”œâ”€â”€ .gitignore                # Gité…ç½® âœ…
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£ âœ…
â”‚   â”œâ”€â”€ QUICKSTART.md         # å¿«é€Ÿå¼€å§‹ âœ…
â”‚   â”œâ”€â”€ ARCHITECTURE.md       # æ¶æ„æ–‡æ¡£ âœ…
â”‚   â””â”€â”€ PROJECT_SUMMARY.md    # æœ¬æ–‡æ¡£ âœ…
â”‚
â”œâ”€â”€ ğŸ§© æ ¸å¿ƒå±‚ (core/)
â”‚   â”œâ”€â”€ __init__.py           âœ…
â”‚   â”œâ”€â”€ base_system.py        # å‘½ç†ç³»ç»ŸæŠ½è±¡åŸºç±» âœ…
â”‚   â”œâ”€â”€ birth_info.py         # ç”Ÿè¾°ä¿¡æ¯æ•°æ®æ¨¡å‹ âœ…
â”‚   â””â”€â”€ chart_result.py       # æ’ç›˜ç»“æœæ•°æ®æ¨¡å‹ âœ…
â”‚
â”œâ”€â”€ ğŸ”Œ ä¼ è¾“å±‚ (transports/)
â”‚   â”œâ”€â”€ __init__.py           âœ…
â”‚   â”œâ”€â”€ base_transport.py     # ä¼ è¾“å±‚æŠ½è±¡ âœ…
â”‚   â””â”€â”€ stdio_transport.py    # stdioå®ç° âœ…
â”‚       # é¢„ç•™: http_transport.py, ws_transport.py
â”‚
â”œâ”€â”€ ğŸ”® ç³»ç»Ÿå±‚ (systems/)
â”‚   â”œâ”€â”€ __init__.py           # æ³¨å†Œä¸­å¿ƒ âœ…
â”‚   â”œâ”€â”€ ziwei/                # ç´«å¾®æ–—æ•° âœ…
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ziwei_system.py   # ç³»ç»Ÿå®ç°
â”‚   â”‚   â””â”€â”€ formatter.py      # æ ¼å¼åŒ–å™¨
â”‚   â”œâ”€â”€ bazi/                 # å…«å­—ï¼ˆé¢„ç•™ï¼‰ğŸ”„
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â””â”€â”€ astrology/            # å æ˜Ÿï¼ˆé¢„ç•™ï¼‰ğŸ”„
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ ğŸ› ï¸ å·¥å…·å±‚ (utils/)
â”‚   â”œâ”€â”€ __init__.py           âœ…
â”‚   â”œâ”€â”€ validators.py         # å‚æ•°éªŒè¯ âœ…
â”‚   â””â”€â”€ formatters.py         # å“åº”æ ¼å¼åŒ– âœ…
â”‚
â”œâ”€â”€ ğŸ§ª æµ‹è¯• (tests/)
â”‚   â”œâ”€â”€ __init__.py           âœ…
â”‚   â””â”€â”€ test_ziwei.py         # ç´«å¾®ç³»ç»Ÿæµ‹è¯• âœ…
â”‚
â””â”€â”€ venv/                     # è™šæ‹Ÿç¯å¢ƒ âœ…
```

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. æŠ½è±¡æ¥å£è®¾è®¡

```python
class BaseFortuneSystem(ABC):
    """å‘½ç†ç³»ç»Ÿç»Ÿä¸€æ¥å£"""
    @abstractmethod
    def get_chart(birth_info) -> Dict
    @abstractmethod
    def get_fortune(birth_info, query_date) -> Dict
    @abstractmethod
    def analyze_palace(birth_info, palace_name) -> Dict
```

**ä¼˜åŠ¿**:
- ç»Ÿä¸€è§„èŒƒï¼Œæ˜“äºç†è§£
- æ”¯æŒå¤šæ€ï¼Œå¯äº’æ¢ç³»ç»Ÿ
- ä¾¿äºæµ‹è¯•å’Œç»´æŠ¤

### 2. ä¼ è¾“å±‚æŠ½è±¡

```python
class BaseTransport(ABC):
    """ä¼ è¾“å±‚ç»Ÿä¸€æ¥å£"""
    @abstractmethod
    def start()
    @abstractmethod
    def send_message(message)
    @abstractmethod
    def receive_message()
```

**ä¼˜åŠ¿**:
- æ”¯æŒå¤šç§ä¼ è¾“åè®®
- stdio/HTTP/WebSocketå¯åˆ‡æ¢
- æœªæ¥å¯æ‰©å±•gRPCã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰

### 3. æ’ä»¶åŒ–æ³¨å†Œ

```python
# è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œ
_SYSTEMS = {}

def register_system(name, system_class):
    _SYSTEMS[name] = system_class

# è‡ªåŠ¨æ³¨å†Œ
try:
    from .ziwei import ZiweiSystem
    register_system('ziwei', ZiweiSystem)
except ImportError:
    pass
```

**ä¼˜åŠ¿**:
- æ— éœ€æ‰‹åŠ¨ç®¡ç†
- å®¹é”™æ€§å¼º
- æ˜“äºæ·»åŠ æ–°ç³»ç»Ÿ

## ğŸ“Š ä¾èµ–å…³ç³»

```
mingli_mcp.py (MCPæœåŠ¡å™¨)
    â†“
transports/ (ä¼ è¾“å±‚)
    â†“
systems/ (ç³»ç»Ÿæ³¨å†Œä¸­å¿ƒ)
    â†“
systems/ziwei/ (ç´«å¾®ç³»ç»Ÿ)
    â†“
py-iztro (ç¬¬ä¸‰æ–¹åº“)
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å‘½ä»¤è¡Œæµ‹è¯•
```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œæµ‹è¯•
python tests/test_ziwei.py

# å¯åŠ¨æœåŠ¡ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
python mingli_mcp.py
```

### Cursoré›†æˆ
```json
{
  "mcpServers": {
    "mingli": {
      "command": ".../venv/bin/python",
      "args": [".../mingli_mcp.py"]
    }
  }
}
```

### ä½¿ç”¨å·¥å…·
```
# åœ¨Cursorä¸­
å¸®æˆ‘æ’ä¸€ä¸ªç´«å¾®æ–—æ•°ç›˜ï¼š2000å¹´8æœˆ16æ—¥ï¼Œå¯…æ—¶ï¼Œå¥³æ€§
```

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

### çŸ­æœŸè®¡åˆ’ï¼ˆ1-2ä¸ªæœˆï¼‰
- [ ] å®ç°å…«å­—ç³»ç»Ÿ (BaziSystem)
- [ ] æ·»åŠ HTTPä¼ è¾“å±‚
- [ ] å®Œå–„é”™è¯¯æç¤ºå’Œç”¨æˆ·ä½“éªŒ
- [ ] æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹

### ä¸­æœŸè®¡åˆ’ï¼ˆ3-6ä¸ªæœˆï¼‰
- [ ] è¥¿æ–¹å æ˜Ÿç³»ç»Ÿ (AstrologySystem)
- [ ] WebSocketä¼ è¾“å±‚ï¼ˆå®æ—¶æŸ¥è¯¢ï¼‰
- [ ] å‘½ç†çŸ¥è¯†åº“é›†æˆ
- [ ] åˆç›˜åŠŸèƒ½

### é•¿æœŸè®¡åˆ’ï¼ˆ6-12ä¸ªæœˆï¼‰
- [ ] AIè§£è¯»åŠŸèƒ½ï¼ˆGPTé›†æˆï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆè‹±æ–‡ã€æ—¥æ–‡ï¼‰
- [ ] Web UIç•Œé¢
- [ ] ç§»åŠ¨ç«¯é€‚é…

## ğŸ’¡ æ‰©å±•ç¤ºä¾‹

### æ·»åŠ å…«å­—ç³»ç»Ÿ

#### æ­¥éª¤1: åˆ›å»ºç³»ç»Ÿç±»
```python
# systems/bazi/bazi_system.py
class BaziSystem(BaseFortuneSystem):
    def get_chart(self, birth_info):
        # è®¡ç®—å››æŸ±
        year = self._calc_year_pillar(birth_info)
        month = self._calc_month_pillar(birth_info)
        day = self._calc_day_pillar(birth_info)
        hour = self._calc_hour_pillar(birth_info)
        
        return {
            'system': 'å…«å­—',
            'pillars': {
                'year': year,
                'month': month,
                'day': day,
                'hour': hour
            }
        }
```

#### æ­¥éª¤2: æ³¨å†Œç³»ç»Ÿ
```python
# systems/__init__.py
from .bazi import BaziSystem
register_system('bazi', BaziSystem)
```

#### æ­¥éª¤3: æ·»åŠ å·¥å…·
```python
# mingli_mcp.py
{
    "name": "get_bazi_chart",
    "description": "è·å–å…«å­—æ’ç›˜",
    "inputSchema": {...}
}
```

### æ·»åŠ HTTPä¼ è¾“

```python
# transports/http_transport.py
from fastapi import FastAPI
from .base_transport import BaseTransport

class HttpTransport(BaseTransport):
    def __init__(self, host, port):
        self.app = FastAPI()
        self.host = host
        self.port = port
    
    def start(self):
        import uvicorn
        uvicorn.run(self.app, host=self.host, port=self.port)
```

é…ç½®ä½¿ç”¨ï¼š
```bash
# .env
TRANSPORT_TYPE=http
HTTP_HOST=0.0.0.0
HTTP_PORT=8080
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æµ‹è¯•ç¯å¢ƒ
- Python 3.13.2
- macOS 24.6.0
- py-iztro 0.1.5

### æ€§èƒ½æ•°æ®
- æ’ç›˜å“åº”æ—¶é—´: ~100ms
- è¿åŠ¿æŸ¥è¯¢æ—¶é—´: ~150ms
- å®«ä½åˆ†ææ—¶é—´: ~120ms
- å†…å­˜å ç”¨: ~50MB

## ğŸ”’ å®‰å…¨æ€§

- âœ… è¾“å…¥éªŒè¯ï¼šæ‰€æœ‰å‚æ•°ç»è¿‡éªŒè¯
- âœ… é”™è¯¯éš”ç¦»ï¼šå•ä¸ªç³»ç»Ÿå¤±è´¥ä¸å½±å“å…¨å±€
- âœ… æ— çŠ¶æ€è®¾è®¡ï¼šé¿å…å†…å­˜æ³„æ¼
- âœ… æ—¥å¿—è®°å½•ï¼šä¾¿äºé—®é¢˜è¿½è¸ª

## ğŸ“ å­¦ä¹ ä»·å€¼

æœ¬é¡¹ç›®å±•ç¤ºäº†ä»¥ä¸‹è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µï¼š

1. **æŠ½è±¡è®¾è®¡**: é€šè¿‡æ¥å£æŠ½è±¡å®ç°é«˜åº¦è§£è€¦
2. **æ’ä»¶æ¶æ„**: åŠ¨æ€åŠ è½½å’Œæ³¨å†Œæœºåˆ¶
3. **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»
4. **åè®®é›†æˆ**: æ ‡å‡†MCPåè®®å®ç°
5. **å¯æµ‹è¯•æ€§**: å®Œæ•´çš„æµ‹è¯•è¦†ç›–
6. **æ–‡æ¡£è§„èŒƒ**: è¯¦ç»†çš„ä»£ç å’Œæ¶æ„æ–‡æ¡£

## ğŸ™ è‡´è°¢

- **py-iztro**: æä¾›ç´«å¾®æ–—æ•°æ’ç›˜ç®—æ³•
- **iztro**: åŸå§‹JavaScriptå®ç°
- **MCPåè®®**: æä¾›AIå·¥å…·é›†æˆæ ‡å‡†
- **Cursor**: ä¼˜ç§€çš„AIç¼–ç¨‹å·¥å…·

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.0.0 (2025-10-27)
- âœ… å®Œæˆæ ¸å¿ƒæ¶æ„è®¾è®¡
- âœ… å®ç°ä¼ è¾“å±‚æŠ½è±¡ï¼ˆstdio/HTTP/WebSocketé¢„ç•™ï¼‰
- âœ… å®ç°ç´«å¾®æ–—æ•°ç³»ç»Ÿ
- âœ… MCPåè®®é›†æˆ
- âœ… å®Œæ•´æµ‹è¯•è¦†ç›–
- âœ… æ–‡æ¡£å®Œå–„

## ğŸ¯ é¡¹ç›®ç›®æ ‡è¾¾æˆ

### åˆå§‹éœ€æ±‚
âœ… ç´«å¾®æ–—æ•°æ’ç›˜MCPæœåŠ¡
âœ… æ˜“äºæ‰©å±•çš„æ¶æ„
âœ… æ”¯æŒå…«å­—ç­‰å…¶ä»–å‘½ç†ç³»ç»Ÿï¼ˆæ¥å£é¢„ç•™ï¼‰
âœ… æ”¯æŒå æ˜Ÿç­‰ç³»ç»Ÿï¼ˆæ¥å£é¢„ç•™ï¼‰
âœ… å‚è€ƒmy_dataworks_mcpå®ç°
âœ… å‚è€ƒziwei.proå®˜æ–¹æ–‡æ¡£

### é¢å¤–å®ç°
âœ… ä¼ è¾“å±‚æŠ½è±¡ï¼ˆæ”¯æŒå¤šç§ä¼ è¾“åè®®ï¼‰
âœ… å®Œæ•´çš„æ–‡æ¡£ä½“ç³»
âœ… æµ‹è¯•è¦†ç›–
âœ… è¿åŠ¿æŸ¥è¯¢åŠŸèƒ½
âœ… å®«ä½åˆ†æåŠŸèƒ½
âœ… Markdownæ ¼å¼åŒ–è¾“å‡º

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥é˜… [README.md](README.md) å’Œ [QUICKSTART.md](QUICKSTART.md)
2. æŸ¥çœ‹ [ARCHITECTURE.md](ARCHITECTURE.md) äº†è§£æ¶æ„ç»†èŠ‚
3. æŸ¥çœ‹ä»£ç æ³¨é‡Šå’Œç¤ºä¾‹
4. æäº¤Issueæˆ–PR

---

**é¡¹ç›®åˆ›å»ºæ—¥æœŸ**: 2025-10-27
**å½“å‰ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

ğŸ”® **å¼€å§‹ä½ çš„å‘½ç†æ¢ç´¢ä¹‹æ—…ï¼**
