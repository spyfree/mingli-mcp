# å‘½ç†MCPæœåŠ¡ (Mingli MCP Server)

ä¸€ä¸ªæ”¯æŒå¤šç§å‘½ç†ç³»ç»Ÿï¼ˆç´«å¾®æ–—æ•°ã€å…«å­—ã€å æ˜Ÿç­‰ï¼‰çš„ Model Context Protocol (MCP) æœåŠ¡å™¨ï¼Œä¸“ä¸º AI å·¥å…·ï¼ˆå¦‚ Cursor IDEï¼‰è®¾è®¡ã€‚

## âœ¨ ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- âœ… **å¤šå‘½ç†ç³»ç»Ÿæ”¯æŒ**: é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œè½»æ¾æ‰©å±•æ–°çš„å‘½ç†ç³»ç»Ÿ
  - âœ… ç´«å¾®æ–—æ•°ï¼ˆå·²å®ç°ï¼‰
  - âœ… å…«å­—ï¼ˆå·²å®ç°ï¼‰â­ **æ–°å¢**
  - ğŸ”„ è¥¿æ–¹å æ˜Ÿï¼ˆé¢„ç•™æ¥å£ï¼‰
- âœ… **å¤šä¼ è¾“æ–¹å¼**: æ”¯æŒstdioã€HTTPã€WebSocketç­‰å¤šç§ä¼ è¾“åè®®
- âœ… **MCPæ ‡å‡†å…¼å®¹**: å®Œå…¨å…¼å®¹ MCP åè®®è§„èŒƒ
- âœ… **æ˜“äºæ‰©å±•**: æ¸…æ™°çš„æŠ½è±¡å±‚è®¾è®¡ï¼Œæ·»åŠ æ–°ç³»ç»Ÿåªéœ€3æ­¥

### ğŸ”® ç´«å¾®æ–—æ•°åŠŸèƒ½
- âœ… **å®Œæ•´æ’ç›˜**: åäºŒå®«ã€ä¸»æ˜Ÿã€è¾…æ˜Ÿã€æ‚è€€ã€å››åŒ–ç­‰
- âœ… **è¿åŠ¿æŸ¥è¯¢**: å¤§é™ã€æµå¹´ã€æµæœˆã€æµæ—¥ã€æµæ—¶
- âœ… **å®«ä½åˆ†æ**: æ·±åº¦åˆ†æç‰¹å®šå®«ä½çš„æ˜Ÿæ›œé…ç½®
- âœ… **å¤šç§å†æ³•**: æ”¯æŒé˜³å†å’Œå†œå†è¾“å…¥
- âœ… **æ ¼å¼åŒ–è¾“å‡º**: JSONå’ŒMarkdownä¸¤ç§è¾“å‡ºæ ¼å¼

### ğŸ´ å…«å­—åŠŸèƒ½ â­ **æ–°å¢**
- âœ… **å››æŸ±æ’ç›˜**: å¹´æœˆæ—¥æ—¶å››æŸ±ã€å¤©å¹²åœ°æ”¯è¯¦ç»†ä¿¡æ¯
- âœ… **åç¥åˆ†æ**: æ¯”è‚©ã€åŠ«è´¢ã€é£Ÿç¥ã€ä¼¤å®˜ã€åè´¢ã€æ­£è´¢ã€ä¸ƒæ€ã€æ­£å®˜ã€åå°ã€æ­£å°
- âœ… **äº”è¡Œåˆ†æ**: é‡‘æœ¨æ°´ç«åœŸåˆ†æ•°ã€ç™¾åˆ†æ¯”ã€å¹³è¡¡åº¦
- âœ… **åœ°æ”¯è—å¹²**: è¯¦ç»†çš„åœ°æ”¯è—å¹²ä¿¡æ¯
- âœ… **è¿åŠ¿æŸ¥è¯¢**: å¤§è¿ã€æµå¹´åˆ†æ
- âœ… **ç¼ºå¤±åˆ†æ**: è‡ªåŠ¨è¯†åˆ«äº”è¡Œç¼ºå¤±å¹¶ç»™å‡ºå»ºè®®
- âœ… **å¤šç§å†æ³•**: æ”¯æŒé˜³å†å’Œå†œå†è¾“å…¥

## ğŸ“‹ å¯ç”¨å·¥å…·

### 1. get_ziwei_chart
è·å–ç´«å¾®æ–—æ•°å®Œæ•´æ’ç›˜ä¿¡æ¯

**å‚æ•°**:
- `date` (string, å¿…éœ€): å‡ºç”Ÿæ—¥æœŸ YYYY-MM-DDï¼Œå¦‚ "2000-08-16"
- `time_index` (integer, å¿…éœ€): æ—¶è¾°åºå· 0-12
  - 0=æ—©å­æ—¶(23-01), 1=ä¸‘æ—¶(01-03), 2=å¯…æ—¶(03-05), 3=å¯æ—¶(05-07)
  - 4=è¾°æ—¶(07-09), 5=å·³æ—¶(09-11), 6=åˆæ—¶(11-13), 7=æœªæ—¶(13-15)
  - 8=ç”³æ—¶(15-17), 9=é…‰æ—¶(17-19), 10=æˆŒæ—¶(19-21), 11=äº¥æ—¶(21-23)
  - 12=æ™šå­æ—¶(23-01)
- `gender` (string, å¿…éœ€): æ€§åˆ« "ç”·" æˆ– "å¥³"
- `calendar` (string, å¯é€‰): å†æ³• "solar"(é˜³å†) æˆ– "lunar"(å†œå†), é»˜è®¤ "solar"
- `is_leap_month` (boolean, å¯é€‰): æ˜¯å¦é—°æœˆï¼Œé»˜è®¤ false
- `format` (string, å¯é€‰): è¾“å‡ºæ ¼å¼ "json" æˆ– "markdown", é»˜è®¤ "markdown"

**ç¤ºä¾‹**:
```json
{
  "date": "2000-08-16",
  "time_index": 2,
  "gender": "å¥³",
  "calendar": "solar"
}
```

### 2. get_ziwei_fortune
è·å–ç´«å¾®æ–—æ•°è¿åŠ¿ä¿¡æ¯

**å‚æ•°**:
- `birth_date` (string, å¿…éœ€): å‡ºç”Ÿæ—¥æœŸ
- `time_index` (integer, å¿…éœ€): æ—¶è¾°åºå·
- `gender` (string, å¿…éœ€): æ€§åˆ«
- `calendar` (string, å¯é€‰): å†æ³•ç±»å‹
- `query_date` (string, å¯é€‰): æŸ¥è¯¢æ—¥æœŸï¼Œä¸å¡«åˆ™ä¸ºä»Šå¤©
- `format` (string, å¯é€‰): è¾“å‡ºæ ¼å¼

### 3. analyze_ziwei_palace
åˆ†æç´«å¾®æ–—æ•°ç‰¹å®šå®«ä½

**å‚æ•°**:
- `birth_date` (string, å¿…éœ€): å‡ºç”Ÿæ—¥æœŸ
- `time_index` (integer, å¿…éœ€): æ—¶è¾°åºå·
- `gender` (string, å¿…éœ€): æ€§åˆ«
- `palace_name` (string, å¿…éœ€): å®«ä½åç§°ï¼Œå¯é€‰å€¼ï¼š
  - å‘½å®«ã€å…„å¼Ÿã€å¤«å¦»ã€å­å¥³ã€è´¢å¸›ã€ç–¾å„
  - è¿ç§»ã€ä»†å½¹ã€å®˜ç¦„ã€ç”°å®…ã€ç¦å¾·ã€çˆ¶æ¯
- `calendar` (string, å¯é€‰): å†æ³•ç±»å‹
- `format` (string, å¯é€‰): è¾“å‡ºæ ¼å¼

### 4. list_fortune_systems
åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å‘½ç†ç³»ç»Ÿ

### 5. get_bazi_chart â­ **æ–°å¢**
è·å–å…«å­—ï¼ˆå››æŸ±ï¼‰æ’ç›˜ä¿¡æ¯

**å‚æ•°**:
- `date` (string, å¿…éœ€): å‡ºç”Ÿæ—¥æœŸ YYYY-MM-DD
- `time_index` (integer, å¿…éœ€): æ—¶è¾°åºå· 0-12
- `gender` (string, å¿…éœ€): æ€§åˆ« "ç”·" æˆ– "å¥³"
- `calendar` (string, å¯é€‰): å†æ³• "solar"(é˜³å†) æˆ– "lunar"(å†œå†), é»˜è®¤ "solar"
- `is_leap_month` (boolean, å¯é€‰): æ˜¯å¦é—°æœˆï¼Œé»˜è®¤ false
- `format` (string, å¯é€‰): è¾“å‡ºæ ¼å¼ "json" æˆ– "markdown", é»˜è®¤ "markdown"

**ç¤ºä¾‹**:
```json
{
  "date": "2000-08-16",
  "time_index": 2,
  "gender": "å¥³"
}
```

**è¾“å‡ºåŒ…å«**:
- å››æŸ±å…«å­—ï¼ˆå¹´æœˆæ—¥æ—¶ï¼‰
- å¤©å¹²åœ°æ”¯è¯¦ç»†ä¿¡æ¯
- åç¥åˆ†æï¼ˆæ¯”è‚©ã€åŠ«è´¢ç­‰ï¼‰
- äº”è¡Œåˆ†æ•°ç»Ÿè®¡
- åœ°æ”¯è—å¹²ä¿¡æ¯
- ç”Ÿè‚–ã€æ—¥ä¸»ç­‰åŸºæœ¬ä¿¡æ¯

### 6. get_bazi_fortune â­ **æ–°å¢**
è·å–å…«å­—è¿åŠ¿ä¿¡æ¯

**å‚æ•°**:
- `birth_date` (string, å¿…éœ€): å‡ºç”Ÿæ—¥æœŸ
- `time_index` (integer, å¿…éœ€): æ—¶è¾°åºå·
- `gender` (string, å¿…éœ€): æ€§åˆ«
- `calendar` (string, å¯é€‰): å†æ³•ç±»å‹
- `query_date` (string, å¯é€‰): æŸ¥è¯¢æ—¥æœŸï¼Œä¸å¡«åˆ™ä¸ºä»Šå¤©
- `format` (string, å¯é€‰): è¾“å‡ºæ ¼å¼

**è¾“å‡ºåŒ…å«**:
- å½“å‰å¹´é¾„
- å¤§è¿ä¿¡æ¯ï¼ˆå¹´é¾„èŒƒå›´ã€å¹²æ”¯ï¼‰
- æµå¹´ä¿¡æ¯ï¼ˆå¹´ä»½ã€å¹²æ”¯ã€ç”Ÿè‚–ï¼‰
- æœ¬å‘½å…«å­—

### 7. analyze_bazi_element â­ **æ–°å¢**
åˆ†æå…«å­—äº”è¡Œå¼ºå¼±

**å‚æ•°**:
- `birth_date` (string, å¿…éœ€): å‡ºç”Ÿæ—¥æœŸ
- `time_index` (integer, å¿…éœ€): æ—¶è¾°åºå·
- `gender` (string, å¿…éœ€): æ€§åˆ«
- `calendar` (string, å¯é€‰): å†æ³•ç±»å‹
- `format` (string, å¯é€‰): è¾“å‡ºæ ¼å¼

**è¾“å‡ºåŒ…å«**:
- æ—¥ä¸»åŠå…¶äº”è¡Œå±æ€§
- äº”è¡Œåˆ†æ•°å’Œç™¾åˆ†æ¯”
- æœ€æ—º/æœ€å¼±äº”è¡Œ
- ç¼ºå¤±äº”è¡Œ
- å¹³è¡¡åº¦è¯„ä»·
- è¡¥æ•‘å»ºè®®

## ğŸ› ï¸ å®‰è£…å’Œé…ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Cursor IDE æˆ–å…¶ä»–æ”¯æŒMCPçš„å·¥å…·

### 1. å…‹éš†é¡¹ç›®
```bash
cd /Users/lix18854/Documents/code
# é¡¹ç›®å·²åœ¨ ziwei_mcp ç›®å½•ä¸­
cd ziwei_mcp
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
```bash
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# æˆ–
venv\Scripts\activate  # Windows
```

### 3. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 4. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶æ ¹æ®éœ€è¦è°ƒæ•´é…ç½®
```

### 5. æµ‹è¯•è¿è¡Œ
```bash
chmod +x mingli_mcp.py
python mingli_mcp.py
```

### 6. é…ç½® Cursor MCP

ç¼–è¾‘æˆ–åˆ›å»º `~/.cursor/mcp.json`:

```json
{
  "mcpServers": {
    "mingli": {
      "command": "/Users/lix18854/Documents/code/ziwei_mcp/venv/bin/python",
      "args": ["/Users/lix18854/Documents/code/ziwei_mcp/mingli_mcp.py"],
      "env": {
        "LOG_LEVEL": "INFO"
      }
    }
  }
}
```

> **æ³¨æ„**: è¯·æ ¹æ®å®é™…è·¯å¾„è°ƒæ•´ `command` å’Œ `args`

### 7. é‡å¯ Cursor
é‡å¯ Cursor IDE ä»¥åŠ è½½æ–°çš„ MCP é…ç½®ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
ziwei_mcp/
â”œâ”€â”€ mingli_mcp.py              # MCPæœåŠ¡å™¨ä¸»å…¥å£
â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç†
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
â”‚
â”œâ”€â”€ core/                      # æ ¸å¿ƒæŠ½è±¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_system.py        # å‘½ç†ç³»ç»ŸæŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ birth_info.py         # ç”Ÿè¾°ä¿¡æ¯æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ chart_result.py       # æ’ç›˜ç»“æœæ•°æ®æ¨¡å‹
â”‚
â”œâ”€â”€ transports/                # ä¼ è¾“å±‚ï¼ˆæ”¯æŒå¤šç§ä¼ è¾“æ–¹å¼ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_transport.py     # ä¼ è¾“å±‚æŠ½è±¡åŸºç±»
â”‚   â””â”€â”€ stdio_transport.py    # stdioä¼ è¾“å®ç°ï¼ˆé»˜è®¤ï¼‰
â”‚   # é¢„ç•™: http_transport.py, ws_transport.py
â”‚
â”œâ”€â”€ systems/                   # å‘½ç†ç³»ç»Ÿå®ç°
â”‚   â”œâ”€â”€ __init__.py           # ç³»ç»Ÿæ³¨å†Œä¸­å¿ƒ
â”‚   â”œâ”€â”€ ziwei/                # ç´«å¾®æ–—æ•°ï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ziwei_system.py  # ç³»ç»Ÿå®ç°
â”‚   â”‚   â””â”€â”€ formatter.py     # ç»“æœæ ¼å¼åŒ–
â”‚   â”œâ”€â”€ bazi/                 # å…«å­—ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â””â”€â”€ astrology/            # å æ˜Ÿï¼ˆé¢„ç•™ï¼‰
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ validators.py         # å‚æ•°éªŒè¯
â”‚   â””â”€â”€ formatters.py         # å“åº”æ ¼å¼åŒ–
â”‚
â””â”€â”€ tests/                     # æµ‹è¯•ï¼ˆå¾…å®Œå–„ï¼‰
    â””â”€â”€ __init__.py
```

## ğŸš€ æ‰©å±•æ–°å‘½ç†ç³»ç»Ÿ

æœ¬é¡¹ç›®é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œæ·»åŠ æ–°å‘½ç†ç³»ç»Ÿåªéœ€3æ­¥ï¼š

### æ­¥éª¤1: åˆ›å»ºç³»ç»Ÿç±»
åœ¨ `systems/` ä¸‹åˆ›å»ºæ–°ç›®å½•ï¼Œå®ç° `BaseFortuneSystem` æ¥å£ï¼š

```python
# systems/bazi/bazi_system.py
from core.base_system import BaseFortuneSystem

class BaziSystem(BaseFortuneSystem):
    def get_system_name(self) -> str:
        return "å…«å­—"
    
    def get_chart(self, birth_info):
        # å®ç°å…«å­—æ’ç›˜é€»è¾‘
        return {...}
    
    # å®ç°å…¶ä»–å¿…éœ€æ–¹æ³•...
```

### æ­¥éª¤2: æ³¨å†Œç³»ç»Ÿ
åœ¨ `systems/__init__.py` ä¸­æ³¨å†Œï¼š

```python
from .bazi import BaziSystem
register_system('bazi', BaziSystem)
```

### æ­¥éª¤3: æ·»åŠ MCPå·¥å…·
åœ¨ `mingli_mcp.py` çš„ `_handle_tools_list()` ä¸­æ·»åŠ å·¥å…·å®šä¹‰ã€‚

å°±è¿™ä¹ˆç®€å•ï¼æ— éœ€ä¿®æ”¹æ ¸å¿ƒæ¡†æ¶ä»£ç ã€‚

## ğŸ”§ ä¼ è¾“å±‚æ‰©å±•

å½“å‰é»˜è®¤ä½¿ç”¨ stdio ä¼ è¾“ï¼ˆé€‚ç”¨äº Cursorï¼‰ã€‚æœªæ¥å¯æ‰©å±•ï¼š

### HTTPä¼ è¾“ï¼ˆé¢„ç•™ï¼‰
```python
# transports/http_transport.py
class HttpTransport(BaseTransport):
    def __init__(self, host, port):
        # å®ç°HTTPæœåŠ¡å™¨
        pass
```

### WebSocketä¼ è¾“ï¼ˆé¢„ç•™ï¼‰
```python
# transports/ws_transport.py
class WebSocketTransport(BaseTransport):
    def __init__(self, host, port):
        # å®ç°WebSocketæœåŠ¡å™¨
        pass
```

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### åœ¨ Cursor ä¸­ä½¿ç”¨

1. **è·å–ç´«å¾®æ’ç›˜**:
```
å¸®æˆ‘æ’ä¸€ä¸ªç´«å¾®æ–—æ•°ç›˜ï¼š2000å¹´8æœˆ16æ—¥ï¼Œå¯…æ—¶ï¼Œå¥³æ€§
```

2. **æŸ¥è¯¢è¿åŠ¿**:
```
æŸ¥è¯¢2000å¹´8æœˆ16æ—¥å¯…æ—¶å‡ºç”Ÿçš„å¥³æ€§ï¼Œä»Šå¤©çš„ç´«å¾®è¿åŠ¿
```

3. **åˆ†æå®«ä½**:
```
åˆ†æä¸Šé¢è¿™ä¸ªäººçš„å‘½å®«
```

### ç¼–ç¨‹è°ƒç”¨

```python
from systems import get_system

# è·å–ç´«å¾®ç³»ç»Ÿ
ziwei = get_system('ziwei')

# å‡†å¤‡ç”Ÿè¾°ä¿¡æ¯
birth_info = {
    'date': '2000-08-16',
    'time_index': 2,  # å¯…æ—¶
    'gender': 'å¥³',
    'calendar': 'solar'
}

# è·å–æ’ç›˜
chart = ziwei.get_chart(birth_info)
print(chart)

# è·å–è¿åŠ¿
from datetime import datetime
fortune = ziwei.get_fortune(birth_info, datetime.now())
print(fortune)

# åˆ†æå®«ä½
palace = ziwei.analyze_palace(birth_info, 'å‘½å®«')
print(palace)
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
pytest tests/

# æµ‹è¯•å•ä¸ªç³»ç»Ÿ
python -m systems.ziwei.ziwei_system
```

## ğŸ“ ä¾èµ–è¯´æ˜

- **py-iztro**: ç´«å¾®æ–—æ•°æ ¸å¿ƒåº“ï¼Œæä¾›æ’ç›˜ç®—æ³•
- **python-dotenv**: ç¯å¢ƒå˜é‡ç®¡ç†
- **python-dateutil**: æ—¥æœŸå¤„ç†

## ğŸ—ºï¸ æœªæ¥è§„åˆ’

- [ ] å®Œå–„å…«å­—ç³»ç»Ÿå®ç°
- [ ] æ·»åŠ è¥¿æ–¹å æ˜Ÿç³»ç»Ÿ
- [ ] å®ç°åˆç›˜åŠŸèƒ½
- [ ] HTTP/WebSocketä¼ è¾“å±‚
- [ ] å‘½ç†çŸ¥è¯†åº“é›†æˆ
- [ ] AIè§£è¯»åŠŸèƒ½
- [ ] æ›´å¤šè¿åŠ¿åˆ†æç»´åº¦

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [iztro](https://github.com/SylarLong/iztro) - ç´«å¾®æ–—æ•° JavaScript åº“
- [py-iztro](https://github.com/x-haose/py-iztro) - Python ç§»æ¤ç‰ˆæœ¬
- [MCP Protocol](https://modelcontextprotocol.io/) - Model Context Protocol è§„èŒƒ

---

**ğŸ”® å¼€å§‹ä½ çš„å‘½ç†æ¢ç´¢ä¹‹æ—…ï¼**
